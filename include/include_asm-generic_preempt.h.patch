--- original/include/asm-generic/preempt.h	2020-05-07 08:06:20.925196610 +0200
+++ changed/include/asm-generic/preempt.h	2019-06-03 13:39:53.000000000 +0200
@@ -7,10 +7,10 @@
 
 static __always_inline int preempt_count(void)
 {
-	return current_thread_info()->preempt_count;
+	return READ_ONCE(current_thread_info()->preempt_count);
 }
 
-static __always_inline int *preempt_count_ptr(void)
+static __always_inline volatile int *preempt_count_ptr(void)
 {
 	return &current_thread_info()->preempt_count;
 }
