--- original/fs/jbd2/commit.c	2020-05-07 08:06:20.212203616 +0200
+++ changed/fs/jbd2/commit.c	2019-06-03 13:39:53.000000000 +0200
@@ -156,6 +156,11 @@ static int journal_submit_commit_record(
 	set_buffer_uptodate(bh);
 	bh->b_end_io = journal_end_buffer_io_sync;
 
+#ifdef CONFIG_JOURNAL_DATA_TAG
+	if (journal->j_flags & JBD2_JOURNAL_TAG)
+		set_buffer_journal(bh);
+#endif
+
 	if (journal->j_flags & JBD2_BARRIER &&
 	    !JBD2_HAS_INCOMPAT_FEATURE(journal,
 				       JBD2_FEATURE_INCOMPAT_ASYNC_COMMIT))
@@ -740,6 +745,10 @@ start_journal_io:
 				clear_buffer_dirty(bh);
 				set_buffer_uptodate(bh);
 				bh->b_end_io = journal_end_buffer_io_sync;
+#ifdef CONFIG_JOURNAL_DATA_TAG
+				if (journal->j_flags & JBD2_JOURNAL_TAG)
+					set_buffer_journal(bh);
+#endif
 				submit_bh(WRITE_SYNC, bh);
 			}
 			cond_resched();
